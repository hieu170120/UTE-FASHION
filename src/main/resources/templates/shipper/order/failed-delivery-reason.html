<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/shipper-layout}">
<head>
    <title>Báo không giao được hàng</title>
</head>
<body>
<div layout:fragment="content">
    <div class="container" style="max-width: 600px; margin: 40px auto;">
        <div class="card shadow-sm">
            <div class="card-header bg-danger text-white">
                <h4 class="mb-0"><i class="fas fa-times-circle"></i> Báo không giao được hàng</h4>
            </div>
            <div class="card-body">
                <!-- Order Info -->
                <div class="alert alert-info">
                    <h5>Thông tin đơn hàng</h5>
                    <p class="mb-1"><strong>Mã đơn:</strong> <span th:text="${order.orderNumber}"></span></p>
                    <p class="mb-1"><strong>Khách hàng:</strong> <span th:text="${order.recipientName}"></span></p>
                    <p class="mb-0"><strong>Địa chỉ:</strong> <span th:text="${order.shippingAddress}"></span></p>
                </div>

                <!-- Cancel Form -->
                <form th:action="@{/shipper/orders/{id}/failed-delivery(id=${order.id})}" method="post">
                    <div class="mb-3">
                        <label class="form-label fw-bold">Lý do không giao được hàng: <span class="text-danger">*</span></label>
                        <select class="form-select mb-2" id="reasonSelect" onchange="updateReason()">
                            <option value="">-- Chọn lý do --</option>
                            <option value="Khách hàng không nhận máy">Khách hàng không nhận máy</option>
                            <option value="Khách hàng hẹn giao lại">Khách hàng hẹn giao lại</option>
                            <option value="Địa chỉ không chính xác">Địa chỉ không chính xác</option>
                            <option value="Khách hàng từ chối nhận hàng">Khách hàng từ chối nhận hàng</option>
                            <option value="Không liên lạc được với khách">Không liên lạc được với khách</option>
                            <option value="custom">Lý do khác...</option>
                        </select>
                        
                        <textarea class="form-control" 
                                  id="reason" 
                                  name="reason" 
                                  rows="4" 
                                  placeholder="Nhập chi tiết lý do..."
                                  required></textarea>
                        <small class="text-muted">Vui lòng mô tả chi tiết tình huống để admin có thể xử lý</small>
                    </div>

                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle"></i> 
                        <strong>Lưu ý:</strong> Đơn hàng sẽ được chuyển về cho admin để xử lý. 
                        Hành động này sẽ được tính vào lịch sử giao hàng của bạn.
                    </div>

                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-danger flex-fill">
                            <i class="fas fa-check"></i> Xác nhận không giao được
                        </button>
                        <a th:href="@{/shipper}" class="btn btn-secondary flex-fill">
                            <i class="fas fa-arrow-left"></i> Quay lại
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script layout:fragment="scripts">
function updateReason() {
    const select = document.getElementById('reasonSelect');
    const textarea = document.getElementById('reason');
    
    if (select.value && select.value !== 'custom') {
        textarea.value = select.value;
    } else if (select.value === 'custom') {
        textarea.value = '';
        textarea.focus();
    }
}
</script>
</body>
</html>
