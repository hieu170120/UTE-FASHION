<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default}">

<head>
    <title>Tin nhắn</title>
    <th:block layout:fragment="styles">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
        <link rel="stylesheet" th:href="@{/static/css/chat-page.css}">
    </th:block>
</head>

<body>

<div class="container-fluid" layout:fragment="content">
    <div class="chat-layout">
        <!-- Conversation List -->
        <div class="conversation-sidebar">
            <div class="sidebar-header">
                <h4>Tin nhắn</h4>
                <button class="btn btn-sm btn-light">
                    <i class="bi bi-pencil-square"></i>
                </button>
            </div>
            <div class="search-bar">
                <input type="text" class="form-control" placeholder="Tìm kiếm trong tin nhắn...">
            </div>
            <div id="conversation-list" class="list-group">
                <!-- Conversations will be loaded here by JavaScript -->
                <div class="text-center p-5">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading conversations...</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Chat Window -->
        <div class="chat-window">
            <div id="chat-welcome-screen" class="chat-welcome-screen">
                <i class="bi bi-chat-dots-fill"></i>
                <h5>Chọn một cuộc trò chuyện để bắt đầu</h5>
                <p>Xem lịch sử tin nhắn và tiếp tục trò chuyện với khách hàng hoặc cửa hàng.</p>
            </div>

            <div id="chat-main-screen" class="d-none">
                <div class="chat-header">
                    <div class="shop-info">
                        <img id="chat-header-avatar" src="" alt="Shop Logo" class="shop-logo">
                        <div>
                            <div id="chat-header-name" class="shop-name"></div>
                            <div class="shop-status">
                                <i class="bi bi-circle-fill"></i> Online
                            </div>
                        </div>
                    </div>
                    <div class="chat-actions">
                        <button class="btn btn-sm btn-light"><i class="bi bi-search"></i></button>
                        <button class="btn btn-sm btn-light"><i class="bi bi-three-dots"></i></button>
                    </div>
                </div>

                <div class="chat-messages" id="chat-messages-container">
                    <!-- Messages will be loaded here -->
                </div>

                <div class="chat-input-area">
                    <div class="input-group">
                        <button class="btn btn-light"><i class="bi bi-paperclip"></i></button>
                        <input type="text" id="chat-message-input" class="form-control" placeholder="Nhập tin nhắn..." autocomplete="off">
                        <button class="btn btn-primary" id="send-chat-message-btn">
                            Gửi <i class="bi bi-send-fill"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<th:block layout:fragment="scripts">
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
    <script th:src="@{/static/js/chat-page.js}"></script>
    <script th:inline="javascript">
        /*<![CDATA[*/
        document.addEventListener('DOMContentLoaded', function() {
            const config = {
                contextPath: /*[[@{/}]]*/ '/',
                csrfToken:   /*[[${_csrf.token}]]*/ '',
                csrfHeader:  /*[[${_csrf.headerName}]]*/ '',
                currentUserId: /*[[${currentUserId}]]*/ null,
                conversationsApiUrl: /*[[@{/chat/api/conversations}]]*/ '/chat/api/conversations',
                messagesApiUrl: /*[[@{/api/chat/messages}]]*/ '/api/chat/messages'
            };
            initChatPage(config);
        });
        /*]]>*/
    </script>
</th:block>

</body>
</html>
