
<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default}">
<head>
    <title>Danh sách sản phẩm</title>
    <th:block layout:fragment="styles">
        <style>
            body {
                background-color: #f5f5f5;
            }
            .product-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
                gap: 1rem;
            }
            .product-card {
                background-color: #fff;
                border: 1px solid #e0e0e0;
                border-radius: 0.25rem;
                transition: box-shadow 0.3s ease;
                text-decoration: none;
                color: inherit;
            }
            .product-card:hover {
                box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            }
            .product-card-img-top {
                width: 100%;
                height: 200px;
                object-fit: cover;
                border-top-left-radius: 0.25rem;
                border-top-right-radius: 0.25rem;
            }
            .product-card-body {
                padding: 1rem;
            }
            .product-card-title {
                font-size: 1rem;
                font-weight: 500;
                margin-bottom: 0.5rem;
                height: 40px; /* Two lines of text */
                overflow: hidden;
            }
            .product-price {
                color: #667eea;
                font-weight: bold;
                font-size: 1.1rem;
            }
            .page-link {
                color: #667eea;
            }
            .page-item.active .page-link {
                z-index: 1;
                color: #fff;
                background-color: #667eea;
                border-color: #667eea;
            }

            /* New Arrivals Section Styles */
            .new-arrivals-section .product-carousel-container {
                position: relative;
            }
            .new-arrivals-section .product-carousel {
                display: flex;
                overflow-x: auto;
                scroll-behavior: smooth;
                -ms-overflow-style: none;  /* IE and Edge */
                scrollbar-width: none;  /* Firefox */
                gap: 1rem;
            }
            .new-arrivals-section .product-carousel::-webkit-scrollbar {
                display: none; /* Chrome, Safari and Opera */
            }
            .new-arrivals-section .new-product-card {
                flex: 0 0 24%; /* Show 4 items */
                max-width: 24%;
                text-align: center;
                text-decoration: none;
                color: #333;
            }
            .new-arrivals-section .product-image-container {
                position: relative;
                background-color: #f0f0f0;
            }
            .new-arrivals-section .sale-badge {
                position: absolute;
                top: 10px;
                right: 10px;
                background-color: #fff;
                color: #000;
                padding: 2px 8px;
                font-size: 0.8rem;
                border: 1px solid #ccc;
            }
            .new-arrivals-section .new-product-card img {
                width: 100%;
                object-fit: cover;
            }
            .new-arrivals-section .new-product-card h6 {
                margin-top: 0.5rem;
                font-size: 0.9rem;
                font-weight: normal;
            }
            .new-arrivals-section .new-product-card .price {
                font-size: 0.9rem;
            }
            .new-arrivals-section .carousel-control-prev,
            .new-arrivals-section .carousel-control-next {
                position: absolute;
                top: 50%;
                transform: translateY(-50%);
                background-color: rgba(128, 128, 128, 0.7);
                color: white;
                border: none;
                width: 40px;
                height: 40px;
                line-height: 40px;
                text-align: center;
                border-radius: 50%;
                z-index: 10;
            }
            .new-arrivals-section .carousel-control-prev {
                left: -20px;
            }
            .new-arrivals-section .carousel-control-next {
                right: -20px;
            }
        </style>
    </th:block>
</head>
<body>

<div class="container-fluid" layout:fragment="content">

    <!-- Carousel Start -->
    <div id="header-carousel" class="carousel slide mb-4" data-bs-ride="carousel">
        <div class="carousel-inner">
            <div class="carousel-item active">
                <img class="w-100" src="https://i.imgur.com/8i6A3n4.png" alt="Banner Image">
            </div>
            <div class="carousel-item">
                <img class="w-100" src="https://images.unsplash.com/photo-1441986300917-64674bd600d8?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="Another Banner">
            </div>
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#header-carousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span><span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#header-carousel" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span><span class="visually-hidden">Next</span>
        </button>
    </div>
    <!-- Carousel End -->

    <!-- New Arrivals Section Start -->
    <div class="container new-arrivals-section my-5">
        <h2 class="text-center mb-4">SẢN PHẨM MỚI</h2>
        <div class="product-carousel-container">
            <div class="product-carousel" id="newArrivalsCarousel">
                <!-- Products will be dynamically inserted here -->
                <a th:href="@{/products/{slug}(slug=${product.slug})}" class="new-product-card" th:each="product : ${productPage.content.subList(0, T(java.lang.Math).min(productPage.content.size(), 8))}">
                    <div class="product-image-container">
                         <img th:src="${!#lists.isEmpty(product.images)} ? ${product.images[0].imageUrl} : 'https://images.unsplash.com/photo-1596755094514-f87e34085b2c?ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&q=80&w=688'"
                             class="img-fluid"
                             th:alt="${product.productName}">
                        <div class="sale-badge" th:if="${product.salePrice != null && product.price != null && product.salePrice.compareTo(product.price) < 0}">
                            -20%
                        </div>
                    </div>
                    <div class="product-info">
                        <h6 th:text="${product.productName}">Đầm suông gấm hoa</h6>
                        <div class="price">
                            <span class="text-danger fw-bold" th:text="${#numbers.formatDecimal(product.salePrice, 0, 'COMMA', 0, 'POINT')} + 'đ'">1,119,200đ</span>
                            <span class="text-muted text-decoration-line-through" th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT')} + 'đ'">1,399,000đ</span>
                        </div>
                    </div>
                </a>
            </div>
            <button class="carousel-control-prev" id="prevBtn">&lt;</button>
            <button class="carousel-control-next" id="nextBtn">&gt;</button>
        </div>
    </div>
    <!-- New Arrivals Section End -->

    <div class="container">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 th:text="${pageTitle} ?: 'Sản phẩm'"></h1>
            <form class="d-flex" th:action="@{/products}" method="get">
                <input class="form-control me-2" type="search" name="keyword" placeholder="Tìm kiếm sản phẩm..." aria-label="Search">
                <button class="btn btn-outline-primary" type="submit" style="white-space: nowrap;">Tìm kiếm</button>
            </form>
        </div>

        <div class="row">
            <!-- Sidebar for categories/filters -->
            <div class="col-lg-3">
                <div class="card mb-4">
                    <div class="card-header"><h4>Danh mục</h4></div>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item" th:each="category : ${categories}">
                            <a th:href="@{/products/category/{slug}(slug=${category.slug})}" th:text="${category.categoryName}">Category Name</a>
                        </li>
                    </ul>
                </div>
                 <div class="card">
                    <div class="card-header"><h4>Thương hiệu</h4></div>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item" th:each="brand : ${brands}">
                            <a th:href="@{/products/brand/{slug}(slug=${brand.slug})}" th:text="${brand.brandName}">Brand Name</a>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Product listing -->
            <div class="col-lg-9">
                <div class="product-grid">
                    <a th:href="@{/products/{slug}(slug=${product.slug})}" class="product-card" th:each="product : ${productPage.content}">
                        <img th:src="${!#lists.isEmpty(product.images)} ? ${product.images[0].imageUrl} : 'https://images.unsplash.com/photo-1596755094514-f87e34085b2c?ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&q=80&w=688'"
                             class="product-card-img-top"
                             th:alt="${product.productName}">
                        <div class="product-card-body">
                            <h5 class="product-card-title" th:text="${product.productName}">Tên sản phẩm</h5>
                            <p class="product-price" th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT')} + ' VNĐ'">Giá sản phẩm</p>
                        </div>
                    </a>
                </div>

                <!-- Pagination -->
                <nav aria-label="Page navigation" th:if="${productPage.totalPages > 1}" class="mt-4">
                     <ul class="pagination justify-content-center">
                        <li class="page-item" th:classappend="${productPage.first} ? 'disabled'">
                            <a class="page-link" th:href="@{/products(page=${productPage.number - 1}, size=${productPage.size}, keyword=${keyword})}" th:if="${#httpServletRequest.requestURI.equals('/products')}">&laquo;</a>
                            <a class="page-link" th:href="@{/products/category/{slug}(slug=${#httpServletRequest.getAttribute('org.springframework.web.servlet.HandlerMapping.uriTemplateVariables')['slug']}, page=${productPage.number - 1}, size=${productPage.size})}" th:if="${#httpServletRequest.requestURI.contains('/category/')}">&laquo;</a>
                            <a class="page-link" th:href="@{/products/brand/{slug}(slug=${#httpServletRequest.getAttribute('org.springframework.web.servlet.HandlerMapping.uriTemplateVariables')['slug']}, page=${productPage.number - 1}, size=${productPage.size})}" th:if="${#httpServletRequest.requestURI.contains('/brand/')}">&laquo;</a>
                            <a class="page-link" th:href="@{/products/shop/{id}(id=${#httpServletRequest.getAttribute('org.springframework.web.servlet.HandlerMapping.uriTemplateVariables')['id']}, page=${productPage.number - 1}, size=${productPage.size})}" th:if="${#httpServletRequest.requestURI.contains('/shop/')}">&laquo;</a>
                        </li>
                        <li class="page-item" th:each="pageNumber : ${#numbers.sequence(0, productPage.totalPages - 1)}"
                            th:classappend="${pageNumber == productPage.number} ? 'active'">
                             <a class="page-link" th:href="@{/products(page=${pageNumber}, size=${productPage.size}, keyword=${keyword})}" th:text="${pageNumber + 1}" th:if="${#httpServletRequest.requestURI.equals('/products')}"></a>
                             <a class="page-link" th:href="@{/products/category/{slug}(slug=${#httpServletRequest.getAttribute('org.springframework.web.servlet.HandlerMapping.uriTemplateVariables')['slug']}, page=${pageNumber}, size=${productPage.size})}" th:text="${pageNumber + 1}" th:if="${#httpServletRequest.requestURI.contains('/category/')}"></a>
                             <a class="page-link" th:href="@{/products/brand/{slug}(slug=${#httpServletRequest.getAttribute('org.springframework.web.servlet.HandlerMapping.uriTemplateVariables')['slug']}, page=${pageNumber}, size=${productPage.size})}" th:text="${pageNumber + 1}" th:if="${#httpServletRequest.requestURI.contains('/brand/')}"></a>
                             <a class="page-link" th:href="@{/products/shop/{id}(id=${#httpServletRequest.getAttribute('org.springframework.web.servlet.HandlerMapping.uriTemplateVariables')['id']}, page=${pageNumber}, size=${productPage.size})}" th:text="${pageNumber + 1}" th:if="${#httpServletRequest.requestURI.contains('/shop/')}"></a>
                        </li>
                        <li class="page-item" th:classappend="${productPage.last} ? 'disabled'">
                             <a class="page-link" th:href="@{/products(page=${productPage.number + 1}, size=${productPage.size}, keyword=${keyword})}" th:if="${#httpServletRequest.requestURI.equals('/products')}">&raquo;</a>
                             <a class="page-link" th:href="@{/products/category/{slug}(slug=${#httpServletRequest.getAttribute('org.springframework.web.servlet.HandlerMapping.uriTemplateVariables')['slug']}, page=${productPage.number + 1}, size=${productPage.size})}" th:if="${#httpServletRequest.requestURI.contains('/category/')}">&raquo;</a>
                             <a class="page-link" th:href="@{/products/brand/{slug}(slug=${#httpServletRequest.getAttribute('org.springframework.web.servlet.HandlerMapping.uriTemplateVariables')['slug']}, page=${productPage.number + 1}, size=${productPage.size})}" th:if="${#httpServletRequest.requestURI.contains('/brand/')}">&raquo;</a>
                             <a class="page-link" th:href="@{/products/shop/{id}(id=${#httpServletRequest.getAttribute('org.springframework.web.servlet.HandlerMapping.uriTemplateVariables')['id']}, page=${productPage.number + 1}, size=${productPage.size})}" th:if="${#httpServletRequest.requestURI.contains('/shop/')}">&raquo;</a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    </div>
</div>

<th:block layout:fragment="scripts">
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const carousel = document.getElementById('newArrivalsCarousel');
            const nextBtn = document.getElementById('nextBtn');
            const prevBtn = document.getElementById('prevBtn');
            const card = carousel.querySelector('.new-product-card');

            if (card) {
                const cardWidth = card.offsetWidth;
                const gap = parseInt(window.getComputedStyle(carousel).gap);

                nextBtn.addEventListener('click', () => {
                    carousel.scrollBy({ left: cardWidth + gap, behavior: 'smooth' });
                });

                prevBtn.addEventListener('click', () => {
                    carousel.scrollBy({ left: -(cardWidth + gap), behavior: 'smooth' });
                });
            }
        });
    </script>
</th:block>

</body>
</html>
