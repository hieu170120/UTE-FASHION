<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default}">
<head>
    <title>Sản phẩm</title>
    <th:block layout:fragment="styles">
        <style>
            .product-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
                gap: 1rem;
            }
            .product-card {
                background-color: #fff;
                border: 1px solid #e0e0e0;
                border-radius: 0.25rem;
                transition: box-shadow 0.3s ease;
                text-decoration: none;
                color: inherit;
                display: flex;
                flex-direction: column;
            }
            .product-card:hover { box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
            .product-card-img-top {
                width: 100%;
                height: 280px;
                object-fit: cover;
                border-top-left-radius: 0.25rem;
                border-top-right-radius: 0.25rem;
            }
            .product-card-body { padding: 1rem; flex-grow: 1; display: flex; flex-direction: column; justify-content: space-between; }
            .product-card-title { font-size: 1rem; font-weight: 500; margin-bottom: 0.5rem; height: 40px; overflow: hidden; }
            .product-price { font-size: 0.9rem; }
            .container h1 { font-size: 22px; font-weight: 700; color: #000; margin: 0; }
            .d-flex.align-items-center.mb-4 { border-bottom: 1px solid #eee; padding-bottom: 10px; }
            form.d-flex { gap: 8px; }
            form.d-flex .form-control { border-radius: 6px; border: 1px solid #ccc; padding: 6px 10px; font-size: 14px; transition: border-color 0.2s ease; }
            form.d-flex .form-control:focus { outline: none; border-color: #000; box-shadow: none; }
            form.d-flex .btn-outline-primary { color: #000; border-color: #000; border-radius: 6px; font-size: 14px; transition: all 0.2s ease; }
            form.d-flex .btn-outline-primary:hover { background-color: #000; color: #fff; }
            .sidebar-categories { font-family: "Roboto", sans-serif; }
            .sidebar-categories .card { border: none !important; box-shadow: none !important; background: transparent !important; margin-bottom: 20px; }
            .sidebar-categories .card-header { background: transparent !important; border: none !important; padding: 0; }
            .sidebar-categories .card-header h4 { font-size: 15px; font-weight: 700; color: #000; margin-bottom: 8px; }
            .sidebar-categories .list-group { border: none !important; }
            .sidebar-categories .list-group-item { border: none !important; background: transparent !important; padding: 4px 0; color: #777; font-size: 14px; transition: color 0.2s ease; }
            .sidebar-categories .list-group-item:hover { color: #000; }
            .sidebar-categories .list-group-item.active { font-weight: 600; color: #000 !important; background: transparent !important; }
            .pagination { display: flex; justify-content: center; list-style: none; padding-left: 0; }
            .pagination .page-item { margin: 0 3px; }
            .pagination .page-link { color: #000; background-color: #fff; border: 1px solid #ddd; padding: 6px 12px; border-radius: 4px; transition: all 0.2s ease; }
            .pagination .page-link:hover { background-color: #f0f0f0; }
            .pagination .active .page-link { background-color: #000; color: #fff; border-color: #000; }
            .pagination .disabled .page-link { color: #ccc; pointer-events: none; background-color: #fff; border-color: #eee; }
        </style>
    </th:block>
</head>
<body>

<div class="container" layout:fragment="content">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 th:text="${pageTitle} ?: 'Sản phẩm'"></h1>
        <form class="d-flex" th:action="@{/products}" method="get">
            <input class="form-control me-2" type="search" name="keyword" placeholder="Tìm kiếm sản phẩm..." aria-label="Search" th:value="${keyword}">
            <button class="btn btn-outline-primary" type="submit" style="white-space: nowrap;">Tìm kiếm</button>
        </form>
    </div>

    <div class="row">
        <!-- Sidebar for categories/filters -->
        <div class="col-lg-3 sidebar-categories">
            <div class="card mb-4">
                <div class="card-header"><h4>Danh mục</h4></div>
                <ul class="list-group list-group-flush">
                    <a th:href="@{/products}" class="list-group-item list-group-item-action" th:classappend="${currentCategory == null and currentBrand == null ? 'active' : ''}">Tất cả sản phẩm</a>
                    <a th:each="category : ${categories}" th:href="@{/products/category/{slug}(slug=${category.slug})}" class="list-group-item list-group-item-action" th:classappend="${#strings.equals(currentCategory, category.slug) ? 'active' : ''}" th:text="${category.categoryName}">Category Name</a>
                </ul>
            </div>
            <div class="card">
                <div class="card-header"><h4>Thương hiệu</h4></div>
                <ul class="list-group list-group-flush">
                    <a th:each="brand : ${brands}" th:href="@{/products/brand/{slug}(slug=${brand.slug})}" class="list-group-item list-group-item-action" th:classappend="${#strings.equals(currentBrand, brand.slug) ? 'active' : ''}" th:text="${brand.brandName}">Brand Name</a>
                </ul>
            </div>
        </div>

        <!-- Product listing -->
        <div class="col-lg-9">
            <div th:if="${productPage.totalElements == 0}" class="text-center">
                <h3>Không tìm thấy sản phẩm nào.</h3>
            </div>
            <div class="product-grid" th:if="${productPage.totalElements > 0}">
                <a th:href="@{/products/{slug}(slug=${product.slug})}" class="product-card" th:each="product : ${productPage.content}">
                    <div class="product-image-container">
                        <img th:src="${!#lists.isEmpty(product.images)} ? ${product.images[0].imageUrl} : 'https://ih1.redbubble.net/image.4905811472.8675/bg,f8f8f8-flat,750x,075,f-pad,750x1000,f8f8f8.jpg'" class="product-card-img-top" th:alt="${product.productName}">
                    </div>
                    <div class="product-card-body">
                        <h5 class="product-card-title" th:text="${product.productName}">Product Name</h5>
                        <div class="product-price">
                            <th:block th:if="${product.salePrice != null and product.salePrice < product.price}">
                                <span class="text-danger fw-bold" th:text="${#numbers.formatDecimal(product.salePrice, 0, 'COMMA', 0, 'POINT')} + 'đ'"></span>
                                <span class="text-muted text-decoration-line-through" th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT')} + 'đ'"></span>
                            </th:block>
                            <th:block th:unless="${product.salePrice != null and product.salePrice < product.price}">
                                <span th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT')} + 'đ'"></span>
                            </th:block>
                        </div>
                    </div>
                </a>
            </div>

            <!-- Pagination -->
            <nav aria-label="Page navigation" th:if="${productPage.totalPages > 1}" class="mt-4">
                <th:block th:with="baseUrl = ${currentCategory != null} ? @{/products/category/{slug}(slug=${currentCategory})} : (${currentBrand != null} ? @{/products/brand/{slug}(slug=${currentBrand})} : (${currentShop != null} ? @{/products/shop/{id}(id=${currentShop})} : @{/products})) "></th:block>
                <ul class="pagination justify-content-center">
                    <li class="page-item" th:classappend="${productPage.first} ? 'disabled'">
                        <a class="page-link" th:href="@{${baseUrl}(page=${productPage.number - 1}, size=${productPage.size}, keyword=${keyword})}">&laquo;</a>
                    </li>
                    <li class="page-item" th:each="pageNumber : ${#numbers.sequence(0, productPage.totalPages - 1)}" th:classappend="${pageNumber == productPage.number} ? 'active'">
                        <a class="page-link" th:href="@{${baseUrl}(page=${pageNumber}, size=${productPage.size}, keyword=${keyword})}" th:text="${pageNumber + 1}"></a>
                    </li>
                    <li class="page-item" th:classappend="${productPage.last} ? 'disabled'">
                        <a class="page-link" th:href="@{${baseUrl}(page=${productPage.number + 1}, size=${productPage.size}, keyword=${keyword})}">&raquo;</a>
                    </li>
                </ul>
            </nav>

        </div>
    </div>
</div>

</body>
</html>