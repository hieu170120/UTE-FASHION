# Test Avatar Upload - Simple Version
Write-Host "=== TEST AVATAR UPLOAD ===" -ForegroundColor Green

# Tạo file ảnh test đơn giản
$testImagePath = "test_avatar.jpg"
if (-not (Test-Path $testImagePath)) {
    Write-Host "Tạo file ảnh test..." -ForegroundColor Yellow
    # Tạo file JPEG đơn giản (1x1 pixel)
    $bytes = [byte[]](0xFF, 0xD8, 0xFF, 0xE0, 0x00, 0x10, 0x4A, 0x46, 0x49, 0x46, 0x00, 0x01, 0x01, 0x01, 0x00, 0x48, 0x00, 0x48, 0x00, 0x00, 0xFF, 0xDB, 0x00, 0x43, 0x00, 0x08, 0x06, 0x06, 0x07, 0x06, 0x05, 0x08, 0x07, 0x07, 0x07, 0x09, 0x09, 0x08, 0x0A, 0x0C, 0x14, 0x0D, 0x0C, 0x0B, 0x0B, 0x0C, 0x19, 0x12, 0x13, 0x0F, 0x14, 0x1D, 0x1A, 0x1F, 0x1E, 0x1D, 0x1A, 0x1C, 0x1C, 0x20, 0x24, 0x2E, 0x27, 0x20, 0x22, 0x2C, 0x23, 0x1C, 0x1C, 0x28, 0x37, 0x29, 0x2C, 0x30, 0x31, 0x34, 0x34, 0x34, 0x1F, 0x27, 0x39, 0x3D, 0x38, 0x32, 0x3C, 0x2E, 0x33, 0x34, 0x32, 0xFF, 0xC0, 0x00, 0x11, 0x08, 0x00, 0x01, 0x00, 0x01, 0x01, 0x01, 0x11, 0x00, 0x02, 0x11, 0x01, 0x03, 0x11, 0x01, 0xFF, 0xC4, 0x00, 0x14, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0xFF, 0xC4, 0x00, 0x14, 0x10, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xDA, 0x00, 0x0C, 0x03, 0x01, 0x02, 0x11, 0x03, 0x11, 0x00, 0x3F, 0x00, 0x00, 0xFF, 0xD9)
    [System.IO.File]::WriteAllBytes($testImagePath, $bytes)
    Write-Host "File ảnh test đã được tạo: $testImagePath" -ForegroundColor Green
}

Write-Host "`n=== HƯỚNG DẪN TEST ===" -ForegroundColor Yellow
Write-Host "1. Đăng nhập vào ứng dụng: http://localhost:5055/UTE_Fashion/login" -ForegroundColor White
Write-Host "2. Vào trang profile: http://localhost:5055/UTE_Fashion/profile" -ForegroundColor White
Write-Host "3. Upload file ảnh test: $testImagePath" -ForegroundColor White
Write-Host "4. Kiểm tra console logs của ứng dụng Spring Boot" -ForegroundColor White
Write-Host "5. Kiểm tra endpoint test: http://localhost:5055/UTE_Fashion/profile/test-avatar" -ForegroundColor White

Write-Host "`n=== DEBUG LOGS CẦN QUAN SÁT ===" -ForegroundColor Cyan
Write-Host "DEBUG: Uploading avatar for user: [username]" -ForegroundColor White
Write-Host "DEBUG: Generated avatar URL: [url]" -ForegroundColor White
Write-Host "DEBUG: File saved to: [path]" -ForegroundColor White
Write-Host "DEBUG: updateProfileDTO.getAvatarUrl() before service call: [url]" -ForegroundColor White
Write-Host "DEBUG: updateProfileDTO.getAvatarUrl() = '[url]'" -ForegroundColor White
Write-Host "DEBUG: Updating avatar URL from '[old]' to '[new]'" -ForegroundColor White
Write-Host "DEBUG: Saving user to database..." -ForegroundColor White
Write-Host "DEBUG: User saved successfully. Avatar URL in DB: [url]" -ForegroundColor White
Write-Host "DEBUG: Profile updated successfully. New avatar URL: [url]" -ForegroundColor White

Write-Host "`n=== KIỂM TRA FILE ĐÃ UPLOAD ===" -ForegroundColor Green
Write-Host "Kiểm tra thư mục: src/main/resources/static/uploads/avatars/" -ForegroundColor White
Write-Host "Nếu có file mới được tạo, upload thành công!" -ForegroundColor White








